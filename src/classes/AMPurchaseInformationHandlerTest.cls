//自定义流程管理的采购信息记录流程测试类
@isTest
private class AMPurchaseInformationHandlerTest {

    static testMethod void test_Save() {
        RecordType rc = [SELECT Id, DeveloperName FROM RecordType WHERE SObjectType = 'Custom_Approval_Managed__c' AND  DeveloperName = 'PurchaseInformation'];
        Contact con = new Contact(LastName = '测试人员',number__c = '123');
        insert con;
        // //创建流程查询SQL
        // Id qId = Utils.getRecordTypeId('Metadata__c', 'Query_SQL');
        // String str5 = '[{"Model_Group__c":"ALL","SQL_Short__c":null,"SQL_Long__c":"SELECT Id,RecordTypeId,SAPID__c,Name,Dept_Name__c,Approval_Name__c,Status__c,Applicant__c,Applicant_Code__c,Applicant_Name__c,Bill_Date__c,Kind_of_Order__c,Bill_No__c,Purchase_Date__c,Vendor__c,Purchase_Org__c,Purchase_Group__c,Corporation__c,Currency__c,Days_of_Payment__c,Percent_of_Payment__c,Exchange_Rate__c,Term_of_Payment__c,Days_of_Payment_Term__c,Percent_of_Payment_Term__c,Amount_Net_Days__c,International_Trade_Term__c,Text_of_Head__c,Required_date__c,Is_Receipt_Info__c,Approval_Status__c,Delivery_Type__c,Account_Name__c,Account_Number__c FROM Approval_Managed__c","Approval_Name__c":"PurchaseOrder"},{"Model_Group__c":"ALL","SQL_Short__c":null,"SQL_Long__c":"SELECT Id,RecordTypeId,SAPID__c,Name,Dept_Name__c,Approval_Name__c,Status__c,Applicant__c,Applicant_Code__c,Applicant_Name__c,Bill_Date__c,Factory__c,Dept_of_CostCenter__c,Required_date__c,Asset_Type__c,Asset_Name__c,Model_and_Spec__c,Asset_Code_Inner__c,Asset_Code__c,Asset_Code_Official__c,Stock_Note__c,Responsible_CostCenter__c,Place__c,Amount_of_Budget__c,Currcency_Budget__c,Quantity__c,Amount_of_Paid__c,Amount_of_Forecast__c,Material_Number__c,Work_Center__c,Keeper_Reserved__c,Capital_Order__c,REQ_Code__c,Reason_of_Purchase__c,Result_Effect_Current_Period__c,Is_Budgeted__c,Price_Purchase__c,Currency__c,Period_Delivery__c,Is_Ok_Factory_Burthen__c,Kind_of_Asset__c,Stock_Number__c,License_Number__c,Status_Asset__c,Purchase__c,Vendor__c,Model_of_Asset__c,Amount_Asset__c,Device_Number__c,Approval_Status__c,Real_Purchase__c FROM Approval_Managed__c","Approval_Name__c":"AssetPurchase"},{"Model_Group__c":"ALL","SQL_Short__c":null,"SQL_Long__c":"SELECT Id,RecordTypeId,SAPID__c,Name,Dept_Name__c,Approval_Name__c,Status__c,Applicant__c,Applicant_Code__c,Applicant_Name__c,Bill_Date__c,Employee__c,Employee_Code__c,Employee_Name__c,Human_Range__c,Department__c,Job_Title__c,Job_Title_Level__c,Birthday__c,Sex__c,Native_Place__c,Phone__c,Salary_Manager__c,Post_Category__c,Take_Office_Date__c,Leave_Office_Date__c,Kind_of_Work__c,Reason_of_Leave__c,Reason_of_Description__c,Remark_of_Explain__c,Reason_of_Leave_Human__c,Work_Date__c ,Dismisson_Reason_of_Operate__c,Approval_Status__c,Validate_Date__c,Operation_Type__c FROM Approval_Managed__c","Approval_Name__c":"StaffLeaveOffice"},{"Model_Group__c":"ALL","SQL_Short__c":null,"SQL_Long__c":"SELECT Id,RecordTypeId,SAPID__c,Name,Dept_Name__c,Approval_Name__c,Status__c,Applicant__c,Applicant_Code__c,Applicant_Name__c,Bill_Date__c,Bill_No__c,Target_of_Travel__c,Type_of_Travel__c,Department_of_Approval__c,Area_of_Travel__c,Vehicle_of_Travel__c,Cost_Budget__c,Currency_of_Budget__c,Is_Borrow__c,Is_Salesperson__c,Is_Training__c,Is_Send_a_Car__c,Is_Before_Day__c,Amount_of_Borrow__c,Currency_of_Borrow__c,Start_Travel_Datetime__c,End_Travel_Datetime__c,Description_of_Travel__c,Driver__c,Plate_Number__c,Approval_Status__c,Employee__c,Employee_Code__c,Start_Travel_Date__c,Start_Travel_Time__c,End_Travel_Date__c,End_Travel_Time__c FROM Custom_Approval_Managed__c","Approval_Name__c":"BusinessTravel"},{"Model_Group__c":"ALL","SQL_Short__c":null,"SQL_Long__c":"SELECT Id,RecordTypeId,SAPID__c,Name,Dept_Name__c,Approval_Name__c,Status__c,Applicant__c,Applicant_Code__c,Applicant_Name__c,Bill_Date__c,Bill_No__c,Option_of_Operate__c,Is_Exist_Scrap__c,Material_Voucherno__c,Voucher_HeaderText__c,Voucher_Date__c,Factory__c,Address_of_Stock__c,Dept_of_CostCenter__c,Order_of_Production__c,Reason_of_Required__c,Approval_Status__c FROM Custom_Approval_Managed__c","Approval_Name__c":"CostCenterSend"},{"Model_Group__c":"ALL","SQL_Short__c":null,"SQL_Long__c":"SELECT Id,RecordTypeId,SAPID__c,Name,Dept_Name__c,Approval_Name__c,Status__c,Applicant__c,Applicant_Code__c,Applicant_Name__c,Bill_Date__c,Type_of_Scrap__c,Factory__c,Vendor__c,Scrap_Date__c,Amount_Receipts__c,Order_of_Sales__c,Invoice_and_Remark__c,Approval_Status__c FROM Custom_Approval_Managed__c","Approval_Name__c":"WasteDispose"},{"Model_Group__c":"ALL","SQL_Short__c":null,"SQL_Long__c":"SELECT Id,RecordTypeId,SAPID__c,Name,Dept_Name__c,Approval_Name__c,Status__c,Applicant__c,Applicant_Code__c,Applicant_Name__c,Bill_Date__c,Number_of_Purchase_Info__c,Status_of_Purchase_Info__c,Kind_of_Material__c,Approval_Status__c FROM Custom_Approval_Managed__c","Approval_Name__c":"PurchaseInformation"},{"Model_Group__c":"ALL","SQL_Short__c":null,"SQL_Long__c":"SELECT Id,RecordTypeId,SAPID__c,Name,Dept_Name__c,Approval_Name__c,Status__c,Applicant__c,Applicant_Code__c,Applicant_Name__c,Bill_Date__c,Employee__c,Employee_Code__c,Employee_Name__c,Human_Range__c,Work_Company_Old__c,Job_Title_Old__c,Job_Title_Level_Old__c,Staff_Group_Old__c,Staff_Sub_Group__c,Work_Company_New__c,Job_Title_New__c,Job_Title_Level_New__c,Staff_Group_New__c,Staff_Sub_Group_New__c,Validate_Date__c,Reason_of_Operate__c,Is_Salary_Adjust__c,Remark_of_Explain__c,Is_Work_Transfered__c,Is_Key_Returned__c,  Handover_Man1__c,Handover_Man1_Code__c,Supervisor1__c,Supervisor1_Code__c,Transfer_Date__c,Handover_Man2__c,Handover_Man2_Code__c,Supervisor2__c,Supervisor2_Code__c,Is_Good_Regurned__c,Handover_Man3__c,Handover_Man3_Code__c,Supervisor3__c,Supervisor3_Code__c,Is_Tools_Returned__c,Handover_Man4__c,Handover_Man4_Code__c,Supervisor4__c,Supervisor4_Code__c,Approval_Status__c,Job_Title_New_Code__c FROM Approval_Managed__c","Approval_Name__c":"StaffTransfer"},{"Model_Group__c":"ALL","SQL_Short__c":null,"SQL_Long__c":"SELECT Id,RecordTypeId,SAPID__c,Name,Dept_Name__c,Approval_Name__c,Status__c,Applicant__c,Applicant_Code__c,Applicant_Name__c,Bill_Date__c,Corporation__c,Purchase_Org__c,Account_Group__c,Vendor_Number__c,Title__c,Retrieve_Item1__c,Retrieve_Item2__c,Vendor_Name__c,Name_Additional__c,Reserved_Street__c,House_Number__c,Postcode__c,Country__c, Country_Code__c, Country_Name__c ,Province__c,Province_Code__c,Province_Name__c,City__c,City_Code__c,City_Name__c,Time_Zone__c,Corp_Postcode__c,Area__c, Area_Code__c , Area_Name__c ,Language__c,Standard_Contac_Method__c,Mobile_Phone__c,Phone__c,Phone_Extension_Number__c,Fax__c,Fax_Extension_Number__c,Email__c,Tax_Number__c,Tax_Number_Additional__c,Business_Type__c,Industry_Type__c,Is_Based_Invoice__c,Purchase_Group__c,Plan_Delivery_Days__c,Control_Subject__c,Sorting_Code__c,Cash_Manage_Group__c,Term_of_Payment_Vendor__c,Payment_Methods__c,Currency__c,Num_Min_Order__c,Corp_Registed_Date__c,Num_Equipment1__c,Num_Equipment2__c,Num_Equipment3__c,Num_Equipment4__c,Num_Equipment5__c,International_Trade_Term__c,Subdivision__c,Project_of_Main__c,Production_Area__c,Annual_Capacity__c,Registered_Capital__c,Term_of_Payment_Corp__c,Term_of_Explain__c,Name_Equipment1__c,Name_Equipment2__c,Name_Equipment3__c,Name_Equipment4__c,Name_Equipment5__c,Num_Employee__c,Spec_Equipment1__c,Spec_Equipment2__c,Spec_Equipment3__c,Spec_Equipment4__c,Spec_Equipment5__c,Remark__c,Approval_Status__c FROM Custom_Approval_Managed__c","Approval_Name__c":"Vendor"},{"Model_Group__c":"ALL","SQL_Short__c":null,"SQL_Long__c":"SELECT Id,RecordTypeId,SAPID__c,Name,Dept_Code__c,Dept_Name__c,Approval_Name__c,Status__c,Applicant__c,Applicant_Code__c,Applicant_Name__c,Bill_Date__c,Kind_of_Order__c,Bill_No__c,Is_Agree_Refund__c,Type_of_Approval__c,Customer_Code__c,Customer_Name__c,Delivery_Party_Code__c,Delivery_Party_Name__c,Reason_of_Order__c,Purchase__c,Purchase_Order_Date__c,Purchase_Required_Date__c,Currency_Purchase__c,Term_of_Purchase_Payment__c,Term_of_Purchase_Trade__c,Weight_Total__c,Opportunity_Code__c,Sales_Org__c,Distribution_Channel__c,Product_Group__c,Price_Group__c,Customer_Group__c,Sales_Area__c,Sales_Office_Area__c,Sales_Group__c,Is_Based_Quotation__c,Code_Reference__c,Currency_Reference__c,Amount_Reference__c,Info_of_Discount__c,Text1_Additional__c,Term_of_Contract__c,Remark__c,NotStandard_Price_Flag__c,Prepare_Feed_Protocol__c,Sales_Employee__c,Approval_Status__c FROM Custom_Approval_Managed__c","Approval_Name__c":"SaleOrder"},{"Model_Group__c":"ALL","SQL_Short__c":null,"SQL_Long__c":"SELECT Id,RecordTypeId,SAPID__c,Name,Dept_Name__c,Approval_Name__c,Status__c,Applicant__c,Applicant_Code__c,Applicant_Name__c,Bill_Date__c,Expense_Type_Cost__c,Corporation__c,Employee__c,Employee_Code__c,Employee_Name__c,Voucher_Code__c,Voucher_Date__c,Posting_Date__c,Same_Sample__c,Voucher_HeaderText__c,Clearing_Description__c,Dept_of_CostCenter__c,Posting_of_Company__c,Amount_of_General__c,Currency__c,Amount_of_Total__c,Remark_of_Explain__c,Approval_Travel__c,Applicant_Travel__c,Target_of_Travel__c,Type_of_Travel__c,Vehicle_of_Travel__c,Cost_Budget__c,Currency_of_Budget__c,Amount_of_Borrow__c,Currency_of_Borrow__c,Start_Travel_Datetime__c,End_Travel_Datetime__c,Approval_Entertained__c,Kind_of_Cost__c,Estimate_Cost__c,Occur_Datetime__c,Place__c,Description_of_Travel__c,Staff_of_Both__c,Approval_Status__c,Is_Invoice__c FROM Approval_Managed__c","Approval_Name__c":"ExpenseReimburse"},{"Model_Group__c":"ALL","SQL_Short__c":null,"SQL_Long__c":"SELECT Id,RecordTypeId,SAPID__c,Name,Dept_Name__c,Approval_Name__c,Status__c,Applicant__c,Applicant_Code__c,Applicant_Name__c,Bill_Date__c,Expense_Type_Prepay__c,Corporation__c,Applicant_Cost__c,Applicant_Code_Cost__c,Applicant_Name_Cost__c,Dept_PR_Approval__c,Term_of_Payment__c,Purchase__c,Amount_of_Purchase__c,Percent_Pay__c,Currency__c,Amount_Prepay__c,Remark_Vendor_Prepay__c,Num_Unfinished__c,Amount_Offset__c,Remark_of_Explain__c,Type_of_Payment__c,Amount_Confirm__c,Approval_Status__c,Supplier_Number__c,Supplier_Name__c FROM Approval_Managed__c","Approval_Name__c":"AdvanceCharge"},{"Model_Group__c":"ALL","SQL_Short__c":null,"SQL_Long__c":"SELECT Id,RecordTypeId,SAPID__c,Name,Dept_Name__c,Approval_Name__c,Status__c,Applicant__c,Applicant_Code__c,Applicant_Name__c,Bill_Date__c,Abnormal_Code__c,Abnormal_Type__c,Account__c,Status_Abnormal__c,Description__c,Dept_of_Discovery__c,Order__c,Make_Man__c,Material_Description__c,Num_Order__c,Num_Unqualified__c,Rate_Unqualified__c,Material_Number__c,Material_Name__c,Dept_of_Duty__c,Manager_of_Duty__c,Person_Liable__c,Operator_Abnormal__c,Is_Withhold__c,Cause_of_Analysis1__c,Cause_of_Analysis2__c,Cause_of_Analysis3__c,Cause_of_Analysis4__c,Cause_of_Analysis5__c,Description_of_Effect__c,Confirmor_of_Effect__c,Confirm_Date_of_Effect__c,Description_Avoid__c,Material_Dealwith__c,Confirmor_of_Feedback__c,Confirm_Date_of_Feedback__c,Rejector__c,Reject_Date__c,Reject_Reason__c,Approval_Status__c FROM Approval_Managed__c","Approval_Name__c":"AbnormalQuality"},{"Model_Group__c":"ALL","SQL_Short__c":null,"SQL_Long__c":"SELECT Id,RecordTypeId,SAPID__c,Name,Dept_Name__c,Approval_Name__c,Status__c,Applicant__c,Applicant_Code__c,Applicant_Name__c,Purchase_Org__c,Distribution_Channel__c,Product_Group__c,Subject_Group__c,Account_Name__c,Bill_Date__c,Account_Number__c,Name_Additional__c,Title__c,Retrieve_Item1__c,Retrieve_Item2__c,Corporation__c,Province__c,Province_Code__c,Province_Name__c,City__c,City_Code__c,City_Name__c,Corp_Address__c,Province_of_Shopping__c,Province_Code_of_Shopping__c,Province_Name_of_Shopping__c,City_of_Shopping__c,City_Code_of_Shopping__c,City_Name_of_Shopping__c,Shopping_Address1__c,Shopping_Address2__c,Billing_Address1__c,Billing_Address2__c,Reserved_Street__c,House_Number__c,Postcode__c,Area__c,Area_Code__c,Area_Name__c,Country__c,Country_Code__c,Country_Name__c,Language__c,Sales_Area__c,Sales_Dept__c,Sales_Group__c,Customer_Group__c,Currency__c,Price_Group__c,Engrave_Type__c,Shipping_Term__c,Delivery_Factory__c,Term_of_Payment__c,Tax_Number__c,Control_Subject__c,Delivery_Priority__c,Is_Order_Portfolio__c,International_Trade_Term__c,Account_Allot_Group__c,Sorting_Code__c,Industry__c,Mobile_Phone__c,Email__c,Phone__c,Phone_Extension_Number__c,Fax__c,Fax_Extension_Number__c,City_Additional__c,Remark__c,Invoice_Address1__c,Sales_Remark__c,Finance_Remark__c,Type__c,Approval_Status__c,Term_of_Payment1__c FROM Custom_Approval_Managed__c","Approval_Name__c":"Customer"},{"Model_Group__c":"ALL","SQL_Short__c":null,"SQL_Long__c":"SELECT Id,RecordTypeId,SAPID__c,Name,Dept_Code__c,Dept_Name__c,Approval_Name__c,Status__c,Approval_Status__c,Applicant__c,Applicant_Code__c,Applicant_Name__c,Bill_Date__c,Request_Datetime__c,Remark__c,Quantity__c,Account_Number__c,Unit__c,Figure_Number__c,Texture_of_Material__c,Quote_Code__c,Quote_Code_History__c,Surfacing__c,Reason_NotTransaction__c,Is_Transaction__c,Corporation__c,Factory__c FROM Custom_Approval_Managed__c","Approval_Name__c":"RFQ"},{"Model_Group__c":"ALL","SQL_Short__c":null,"SQL_Long__c":"SELECT Id,RecordTypeId,SAPID__c,Name,Dept_Code__c,Dept_Name__c,Approval_Name__c,Status__c,Approval_Status__c,Applicant__c,Applicant_Code__c,Applicant_Name__c,Bill_Date__c,Employee__c,Employee_Code__c,Employee_Name__c,Kind_of_Cost__c,Estimate_Cost__c,Occur_Datetime__c,Currency__c,Account__c,Account_Number__c,Account_Name__c,Place__c,Description_of_Travel__c,Staff_of_Both__c,Arrangement__c FROM Approval_Managed__c","Approval_Name__c":"EntertaineCost"}]';
        // List<Metadata__c> sqls = (List<Metadata__c>)JSON.deserialize(str5,List<Metadata__c>.class);
        // for(Metadata__c md : sqls){
        //     md.RecordTypeId = qId;
        // }
        // INSERT sqls;
        createApprovalconfig(26,'PurchaseInformation');
        //配置文件数据创建
        System_Setting__c ssc = new System_Setting__c();
        ssc.Name = 'Setting';
        ssc.Specify_Approval__c = '10210006,60210001';
        ssc.Specify_Approal_Employee__c = '10210000';
        INSERT ssc;

        Custom_Approval_Managed__c cusApprove = new Custom_Approval_Managed__c();
        cusApprove.Applicant__c = con.Id;
        cusApprove.RecordTypeId = rc.Id;
        INSERT cusApprove;
        cusApprove.Kind_of_Material__c = 'F';
        cusApprove.Is_Reset_Approvaler__c = true;
        Update cusApprove;



    }

       /***
    创建相应审批配置记录
    ***/
    static  void createApprovalconfig(Integer step, String approvalName) {
        if (step>0) {
            RecordType rc = [SELECT Id, DeveloperName FROM RecordType WHERE SObjectType = 'Organizational__c' AND  DeveloperName = 'Approval_Config'];
            List<Organizational__c> lstOrg = new List<Organizational__c>();
            for (Integer i =0;i<step ; i++) {
                lstOrg.add(new Organizational__c(Approval_Name__c = approvalName ,Approval_Step__c = i+1, Approval_Rule__c = '指定人具体字段',RecordTypeId=rc.Id));
            }
            System.debug(LoggingLevel.INFO, '*** lstOrg: ' + lstOrg);
            insert lstOrg;
        }
    }
}